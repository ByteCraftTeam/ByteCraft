# ByteCraft CLI 项目架构

## 🏗️ 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    ByteCraft CLI                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   User Input    │    │   Terminal UI   │                │
│  │   (命令行输入)   │───▶│   (Ink.js)      │                │
│  └─────────────────┘    └─────────────────┘                │
│                                    │                       │
│                                    ▼                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    Core Layer                           │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │   Agent     │  │   Tools     │  │  Session    │     │ │
│  │  │  (LangChain)│  │  (Weather)  │  │  Manager    │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                    │                       │
│                                    ▼                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                   AI Model Layer                        │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │ │
│  │  │  DeepSeek   │  │   OpenAI    │  │  Streaming  │     │ │
│  │  │   Model     │  │   API       │  │   Output    │     │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘     │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 📁 文件结构详解

```
ByteCraft/
├── 📄 配置文件
│   ├── config.yaml              # 主配置文件
│   ├── config.yaml.example      # 配置示例
│   ├── tsconfig.json           # TypeScript配置
│   └── package.json            # 项目依赖
│
├── 📂 src/                      # 源代码目录
│   ├── 📂 config/              # 配置管理
│   │   └── config.ts           # 配置读取和管理
│   │
│   ├── 📂 types/               # 类型定义
│   │   ├── index.ts            # 集中类型定义
│   │   └── example.ts          # 类型使用示例
│   │
│   ├── 📂 utils/               # 工具和工具函数
│   │   ├── 📂 agent/           # AI Agent
│   │   │   └── agent.ts        # 主要Agent实现
│   │   │
│   │   ├── 📂 tools/           # 工具集合
│   │   │   └── weather.ts      # 天气查询工具
│   │   │
│   │   ├── 📂 logger/          # 日志工具
│   │   └── 📂 session/         # 会话管理
│   │
│   ├── 📂 ui/                  # 用户界面
│   │   ├── 📂 components/      # UI组件
│   │   └── 📂 hooks/           # React Hooks
│   │
│   └── index.ts                # 应用入口
│
├── 📂 docs/                    # 文档目录
│   ├── README.md              # 项目说明
│   ├── DEVELOPMENT.md         # 开发文档
│   └── ARCHITECTURE.md        # 架构文档
│
└── 📂 tests/                   # 测试目录
    ├── unit/                  # 单元测试
    └── integration/           # 集成测试
```

## 🔄 数据流程图

```
用户输入流程:
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 用户输入 │───▶│ UI层    │───▶│ Agent   │───▶│ AI模型  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
                                 │
                                 ▼
                            ┌─────────┐
                            │ 工具调用 │
                            └─────────┘

响应输出流程:
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ AI模型   │───▶│ 流式输出 │───▶│ UI渲染  │───▶│ 用户显示 │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
```

## 🧩 模块依赖关系

```
依赖关系图:
types/ ←── config/
  ↑         ↑
  │         │
  └───┬─────┘
      │
      ▼
   utils/
   ├── agent/ ←── tools/
   ├── logger/
   └── session/
      │
      ▼
     ui/
   ├── components/
   └── hooks/
```

## 🔧 技术栈架构

```
技术栈层次:
┌─────────────────────────────────────────┐
│             应用层 (Application)         │
│  - CLI 界面 (Ink.js + React)            │
│  - 用户交互逻辑                          │
├─────────────────────────────────────────┤
│             业务层 (Business)            │
│  - AI Agent (LangChain)                 │
│  - 工具系统 (Tools)                      │
│  - 会话管理 (Session)                    │
├─────────────────────────────────────────┤
│             服务层 (Service)             │
│  - AI 模型服务 (DeepSeek API)            │
│  - 配置管理 (YAML)                       │
│  - 日志服务 (Logger)                     │
├─────────────────────────────────────────┤
│             基础设施层 (Infrastructure)  │
│  - TypeScript                           │
│  - Node.js                              │
│  - pnpm                                 │
└─────────────────────────────────────────┘
```

## 🎯 核心模块说明

### 1. 配置管理模块 (`src/config/`)
- **职责**: 管理应用配置
- **输入**: YAML 配置文件
- **输出**: 类型安全的配置对象
- **特点**: 自动验证、默认值回退

### 2. 类型定义模块 (`src/types/`)
- **职责**: 集中管理所有类型定义
- **包含**: 配置类型、UI类型、工具类型
- **特点**: 类型安全、易于维护

### 3. AI Agent 模块 (`src/utils/agent/`)
- **职责**: 核心 AI 对话逻辑
- **技术**: LangChain + DeepSeek
- **特点**: 流式输出、工具调用

### 4. 工具系统 (`src/utils/tools/`)
- **职责**: 功能工具实现
- **当前**: 天气查询工具
- **扩展**: 易于添加新工具

### 5. UI 系统 (`src/ui/`)
- **职责**: 终端用户界面
- **技术**: Ink.js + React
- **特点**: 组件化、响应式

## 🔄 扩展点

### 1. 工具扩展
```
位置: src/utils/tools/
方式: 继承 Tool 基类
示例: weather.ts
```

### 2. UI 组件扩展
```
位置: src/ui/components/
方式: React 组件
示例: MyComponent.tsx
```

### 3. 配置扩展
```
位置: src/types/index.ts
方式: 添加新接口
示例: NewFeatureConfig
```

### 4. Agent 扩展
```
位置: src/utils/agent/agent.ts
方式: 添加新工具到工具列表
示例: tools.push(newTool)
```

## 📊 性能考虑

### 1. 流式输出
- 减少用户等待时间
- 实时显示响应内容
- 提升用户体验

### 2. 配置缓存
- 避免重复读取配置文件
- 内存中缓存配置对象
- 快速配置访问

### 3. 工具懒加载
- 按需加载工具
- 减少内存占用
- 提高启动速度

## 🔒 安全考虑

### 1. API 密钥管理
- 使用配置文件存储
- 不在代码中硬编码
- 支持环境变量

### 2. 输入验证
- 验证用户输入
- 防止注入攻击
- 类型安全检查

### 3. 错误处理
- 不暴露敏感信息
- 友好的错误提示
- 错误日志记录

---

**架构设计原则**: 模块化、可扩展、类型安全、易于维护 